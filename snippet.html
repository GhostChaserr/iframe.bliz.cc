<div
  id="bliz__overlay_container_k7p9m2n4"
  class="bliz__overlay"
  style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
  "
>
  <iframe
    src="{{BLIZ_WIDGET_URL}}"
    class="bliz__iframe"
    style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
    "
    title="Promotion Widget"
  ></iframe>
  <button
    id="bliz__close_x8q1r5t2"
    class="bliz__close_btn"
    style="
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ffffff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      border: 2px solid #000000;
      cursor: pointer;
      font-size: 24px;
      font-weight: bold;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      color: #000000;
    "
  >
    Ã—
  </button>
</div>

<script>
  // Check if widget should be shown
  function hasWidgetBeenShown() {
    return document.cookie.indexOf("widgetShown=true") !== -1;
  }

  // Close overlay function
  function closeOverlay() {
    var container = document.getElementById("bliz__overlay_container_k7p9m2n4");
    if (container && container.parentNode) {
      container.parentNode.removeChild(container);
      document.cookie = "widgetShown=true; path=/; max-age=86400";
    }
  }

  // Initialize the widget
  function initWidget() {
    if (!hasWidgetBeenShown()) {
      var closeButton = document.getElementById("bliz__close_x8q1r5t2");
      var overlayContainer = document.getElementById(
        "bliz__overlay_container_k7p9m2n4"
      );
      var iframe = overlayContainer.querySelector("iframe");

      // Close button click handler
      if (closeButton) {
        closeButton.addEventListener("click", function (e) {
          e.preventDefault();
          closeOverlay();
        });
      }

      // Close when clicking on overlay background (but not iframe)
      if (overlayContainer) {
        overlayContainer.addEventListener("click", function (e) {
          // Check if click is directly on the overlay (not iframe or button)
          if (e.target === overlayContainer) {
            closeOverlay();
          }
        });
      }

      // Close on Escape key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeOverlay();
        }
      });

      // Close message from iframe
      window.addEventListener("message", function (event) {
        try {
          var widgetDomain = new URL("{{BLIZ_WIDGET_URL}}").hostname;
          if (
            event.origin.includes(widgetDomain) &&
            event.data === "closeWidget"
          ) {
            closeOverlay();
          }
        } catch (e) {
          console.error("Error processing message:", e);
        }
      });

      // Make sure iframe can receive clicks
      if (iframe) {
        iframe.style.pointerEvents = "auto";
      }
    } else {
      closeOverlay();
    }
  }

  // Initialize when DOM is ready or immediately if already loaded
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initWidget);
  } else {
    initWidget();
  }
</script>
